FROM node:20-alpine as build

WORKDIR /app

COPY package.json package-lock.json* ./
RUN npm ci || npm i

COPY . .

# Build with Vite, allowing backend URL override
ARG VITE_BACKEND_SERVER
ENV VITE_BACKEND_SERVER=${VITE_BACKEND_SERVER}
RUN npm run build

FROM node:20-alpine
WORKDIR /app

# Install only serve dependency to host static files
RUN npm i -g serve

COPY --from=build /app/dist /app/dist

ENV NODE_ENV=production
ENV PORT=3000
EXPOSE 3000

CMD ["serve", "-s", "dist", "-l", "3000"]